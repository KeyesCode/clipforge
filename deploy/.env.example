# ClipForge Deployment Environment Configuration
# This file contains environment variables for the entire Docker Compose stack

# ====== HOST PORTS (required so ports: donâ€™t collapse to blank) ======
ORCHESTRATOR_PORT=3001
WEBSOCKET_PORT=3002
WEB_PORT=3000
PUBLISHER_PORT=3003

# =============================================================================
# DATABASE CONFIGURATION
# =============================================================================
POSTGRES_DB=clipforge
POSTGRES_USER=clipforge_user
POSTGRES_PASSWORD=clipforge_secure_password_2024
POSTGRES_HOST=postgres
POSTGRES_PORT=5432

# Database connection string for services
DATABASE_URL=postgresql://clipforge_user:clipforge_secure_password_2024@postgres:5432/clipforge

# =============================================================================
# REDIS CONFIGURATION
# =============================================================================
REDIS_HOST=redis
REDIS_PORT=6379
REDIS_PASSWORD=redis_secure_password_2024

# Queue-specific Redis configuration
QUEUE_REDIS_HOST=redis
QUEUE_REDIS_PORT=6379
QUEUE_REDIS_DB=1
QUEUE_REDIS_PASSWORD=redis_secure_password_2024

# =============================================================================
# MICROSERVICE URLS
# =============================================================================
ORCHESTRATOR_URL=http://orchestrator:${ORCHESTRATOR_PORT}
INGEST_SERVICE_URL=http://ingest-svc:8001
ASR_SERVICE_URL=http://asr-svc:8002
VISION_SERVICE_URL=http://vision-svc:8003
SCORING_SERVICE_URL=http://scoring-svc:8004
RENDER_SERVICE_URL=http://render-svc:8005
PUBLISHER_SERVICE_URL=http://publisher:${PUBLISHER_PORT}
WEB_UI_URL=http://web:3000

# =============================================================================
# APPLICATION SETTINGS
# =============================================================================
NODE_ENV=production
API_PREFIX=api/v1

# JWT Authentication
JWT_SECRET=clipforge_jwt_super_secret_key_2024_change_in_production
JWT_EXPIRES_IN=7d

# File Storage
UPLOAD_PATH=/app/uploads
STORAGE_PATH=/app/storage
MAX_FILE_SIZE=10737418240
# Max file size: 10GB in bytes

# =============================================================================
# PROCESSING CONFIGURATION
# =============================================================================
MAX_CONCURRENT_JOBS=5
CHUNK_DURATION_SECONDS=30
MIN_CLIP_DURATION_SECONDS=15
MAX_CLIP_DURATION_SECONDS=60

# Video processing settings
DEFAULT_VIDEO_QUALITY=720p
SUPPORTED_FORMATS=mp4,webm,avi,mov,mkv
MAX_VIDEO_DURATION_HOURS=8

# =============================================================================
# EXTERNAL API KEYS (PUBLISHERS)
# =============================================================================
# YouTube Data API v3
YOUTUBE_CLIENT_ID=your_youtube_client_id_here
YOUTUBE_CLIENT_SECRET=your_youtube_client_secret_here
YOUTUBE_REDIRECT_URI=http://localhost:3000/auth/youtube/callback

# Twitter/X API v2
TWITTER_API_KEY=your_twitter_api_key_here
TWITTER_API_SECRET=your_twitter_api_secret_here
TWITTER_ACCESS_TOKEN=your_twitter_access_token_here
TWITTER_ACCESS_TOKEN_SECRET=your_twitter_access_token_secret_here
TWITTER_BEARER_TOKEN=your_twitter_bearer_token_here

# =============================================================================
# AI/ML MODEL CONFIGURATION
# =============================================================================
# Whisper ASR settings

# GPU
# WHISPER_DEVICE=cuda
# WHISPER_COMPUTE_TYPE=float16

WHISPER_DEVICE=cpu
WHISPER_COMPUTE_TYPE=int8

WHISPER_MODEL=medium

# Face detection settings
FACE_DETECTION_MODEL=buffalo_l
FACE_DETECTION_THRESHOLD=0.6

# Scene detection settings
SCENE_DETECTION_THRESHOLD=30.0
SCENE_DETECTION_MIN_DURATION=1.0

# =============================================================================
# LOGGING AND MONITORING
# =============================================================================
LOG_LEVEL=info
LOG_FORMAT=json
ENABLE_REQUEST_LOGGING=true
ENABLE_PERFORMANCE_MONITORING=true

# Metrics and health checks
HEALTH_CHECK_INTERVAL=30
METRICS_PORT=9090

# =============================================================================
# SECURITY SETTINGS
# =============================================================================
# CORS configuration
CORS_ORIGINS=http://localhost:3000,http://localhost:3002,http://web:3002
CORS_METHODS=GET,POST,PUT,DELETE,PATCH,OPTIONS
CORS_CREDENTIALS=true

# Rate limiting
RATE_LIMIT_WINDOW_MS=900000
# 15 minutes in milliseconds
RATE_LIMIT_MAX_REQUESTS=100

# =============================================================================
# DEVELOPMENT SETTINGS
# =============================================================================
# Set to true for development mode
DEBUG_MODE=false
ENABLE_SWAGGER=true
ENABLE_CORS=true

# Hot reload for development
ENABLE_HOT_RELOAD=false

# =============================================================================
# DOCKER COMPOSE SPECIFIC
# =============================================================================
# Container restart policy
RESTART_POLICY=unless-stopped

# Network configuration
NETWORK_NAME=clipforge-network

# Volume mounts
HOST_POSTGRES_DATA_PATH=./data/postgres
HOST_REDIS_DATA_PATH=./data/redis
HOST_UPLOADS_PATH=./data/uploads
HOST_STORAGE_PATH=./data/storage
HOST_LOGS_PATH=./logs

# =============================================================================
# RESOURCE LIMITS
# =============================================================================
# Memory limits for containers (in MB)
ORCHESTRATOR_MEMORY_LIMIT=1024
WEB_MEMORY_LIMIT=512
PUBLISHER_MEMORY_LIMIT=512
INGEST_MEMORY_LIMIT=2048
ASR_MEMORY_LIMIT=4096
VISION_MEMORY_LIMIT=3072
SCORING_MEMORY_LIMIT=1024
RENDER_MEMORY_LIMIT=2048

# CPU limits (number of cores)
ORCHESTRATOR_CPU_LIMIT=1.0
WEB_CPU_LIMIT=0.5
PUBLISHER_CPU_LIMIT=0.5
INGEST_CPU_LIMIT=2.0
ASR_CPU_LIMIT=2.0
VISION_CPU_LIMIT=1.5
SCORING_CPU_LIMIT=1.0
RENDER_CPU_LIMIT=2.0

# =============================================================================
# BACKUP AND MAINTENANCE
# =============================================================================
# Database backup settings
BACKUP_ENABLED=true
BACKUP_SCHEDULE=0 2 * * *
# Daily at 2 AM
BACKUP_RETENTION_DAYS=7

# Cleanup settings
CLEANUP_TEMP_FILES=true
CLEANUP_INTERVAL_HOURS=24
CLEANUP_OLD_JOBS_DAYS=30

# =============================================================================
# FEATURE FLAGS
# =============================================================================
ENABLE_FACE_DETECTION=true
ENABLE_SCENE_DETECTION=true
ENABLE_AUDIO_ANALYSIS=true
ENABLE_SENTIMENT_ANALYSIS=false
ENABLE_AUTO_PUBLISHING=false
ENABLE_WEBHOOK_NOTIFICATIONS=false

# =============================================================================
# NOTIFICATION SETTINGS
# =============================================================================
# Email notifications (optional)
SMTP_HOST=smtp.gmail.com
SMTP_PORT=587
SMTP_USER=your_email@gmail.com
SMTP_PASSWORD=your_app_password
SMTP_FROM=ClipForge <noreply@clipforge.local>

# Webhook URLs for notifications
WEBHOOK_JOB_COMPLETED=
WEBHOOK_JOB_FAILED=
WEBHOOK_CLIP_READY=

# =============================================================================
# CUSTOM CONFIGURATION
# =============================================================================
# Custom branding
APP_NAME=ClipForge
APP_VERSION=1.0.0
APP_DESCRIPTION=AI Stream Clipper - Local-first highlight extraction and publishing

# Timezone
TZ=UTC

# Language settings
DEFAULT_LANGUAGE=en
SUPPORTED_LANGUAGES=en,es,fr,de,ja,ko

# =============================================================================
# ENVIRONMENT VALIDATION
# =============================================================================
# Required environment check
REQUIRED_SERVICES=postgres,redis,orchestrator,ingest-svc,asr-svc,vision-svc,scoring-svc,render-svc
OPTIONAL_SERVICES=publisher,web

# Health check URLs
HEALTH_CHECK_POSTGRES=postgres://clipforge_user:clipforge_secure_password_2024@postgres:5432/clipforge
HEALTH_CHECK_REDIS=redis://redis:6379


# Added

# ====== URLS expected by compose ======
NEXT_PUBLIC_API_URL=http://localhost:${ORCHESTRATOR_PORT}
NEXT_PUBLIC_WS_URL=ws://localhost:${WEBSOCKET_PORT}
NEXTAUTH_URL=http://localhost:${WEB_PORT}
NEXTAUTH_SECRET=change_me

# ====== Redis URL expected by compose ======
# include password; DB 0 for app queues by default
REDIS_URL=redis://:${REDIS_PASSWORD:-redis_secure_password_2024}@${REDIS_HOST:-redis}:${REDIS_PORT:-6379}/0

# ====== Orchestrator/Websocket internal config (keep app ports stable) ======
# (We'll also adjust compose mapping below.)
JOB_TIMEOUT=600000
TEMP_DIR=/tmp

# ====== ASR (names compose expects) ======
LANGUAGE=en
BEAM_SIZE=5
VAD_FILTER=true
VAD_THRESHOLD=0.6

# ====== Vision (compose names) ======
SCENE_THRESHOLD=${SCENE_DETECTION_THRESHOLD:-30}
MIN_SCENE_LENGTH=${SCENE_DETECTION_MIN_DURATION:-1}
FRAME_SAMPLE_RATE=2

# ====== Scoring (compose names) ======
SCORING_MODEL=default
FEATURE_WEIGHTS_ASR=1.0
FEATURE_WEIGHTS_VISION=1.0
FEATURE_WEIGHTS_AUDIO=1.0
MIN_CLIP_DURATION=${MIN_CLIP_DURATION_SECONDS:-15}
MAX_CLIP_DURATION=${MAX_CLIP_DURATION_SECONDS:-60}
TOP_CLIPS_COUNT=10
OVERLAP_THRESHOLD=0.2

# ====== Ingest/Render pipeline (compose names) ======
CHUNK_DURATION=${CHUNK_DURATION_SECONDS:-30}
CHUNK_OVERLAP=5
MAX_RESOLUTION=1080
AUDIO_BITRATE=128k
VIDEO_CODEC=h264
AUDIO_CODEC=aac
MAX_DOWNLOAD_SIZE=20GB
DOWNLOAD_TIMEOUT=900000

OUTPUT_FORMATS=mp4,webm
CAPTION_STYLE=default
CAPTION_FONT=Inter
CAPTION_FONT_SIZE=32
CAPTION_POSITION=bottom
WATERMARK_ENABLED=false
WATERMARK_PATH=
WATERMARK_POSITION=top-right
WATERMARK_OPACITY=0.5

# ====== CORS (compose expects singular) ======
CORS_ORIGIN=http://localhost:${WEB_PORT}

# ====== Twitter name mismatch bridge ======
TWITTER_ACCESS_SECRET=${TWITTER_ACCESS_TOKEN_SECRET}


FACE_CONFIDENCE_THRESHOLD=0.6
MAX_UPLOAD_SIZE=150MB
UPLOAD_TIMEOUT=600000
